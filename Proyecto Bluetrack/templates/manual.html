<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual de Control - BlueTrack</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body id="manual">
    <!-- Barra de navegaciÃ³n -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="user-info">
                <img src="{{ url_for('static', filename='agua.png') }}" alt="User Icon">
                <span>USER</span>
            </div>

            <ul class="nav-menu">
                <li class="nav-item"><a href="{{ url_for('paginas.categorias') }}" class="nav-link">CategorÃ­as</a></li>
                <li class="nav-item active"><a href="{{ url_for('consumo_bp.manual_control') }}" class="nav-link">Manual de Control</a></li>
                <li class="nav-item"><a href="{{ url_for('paginas.procesos') }}" class="nav-link">Procesos</a></li>
                <li class="nav-item"><a href="{{ url_for('paginas.comunidad') }}" class="nav-link">Comunidad</a></li>
                <li class="nav-item"><a href="{{ url_for('paginas.control') }}" class="nav-link">Control Centralizado</a></li>
            </ul>
            
            <div class="nav-footer">
                <span class="support-item">ðŸ’§ Soporte de Agua</span>
                <a href="{{ url_for('auth.index') }}" class="close-nav-btn">
                    <i class="fas fa-sign-out-alt"></i> Cerrar sesiÃ³n
                </a>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <main class="content">
        <header class="content-header">
            <h1>Control de Agua</h1>
        </header>

        <div class="water-control-container">
            <!-- SecciÃ³n de Monitoreo -->
            <section class="control-section">
                <h2><i class="fas fa-tint"></i> Agua</h2>
                <div class="control-cards">
                    <div class="control-card">
                        <div class="control-icon"><i class="fas fa-water"></i></div>
                        <h3>Consumo de Agua semanal</h3>
                        <div class="control-value">120 L</div>
                        <div class="control-description">Consumo diario</div>
                    </div>
                    
                    <div class="control-card">
                        <div class="control-icon"><i class="fas fa-cloud-rain"></i></div>
                        <h3>Ahorro o exceso</h3>
                        <div class="control-value">65%</div>
                        <div class="control-description">Nivel Ã³ptimo</div>
                    </div>
                    
                    <div class="control-card">
                        <div class="control-icon"><i class="fas fa-thermometer-half"></i></div>
                        <h3>Consumo por actividad</h3>
                        <div class="control-value">40%</div>
                        <div class="control-description">Por persona</div>
                    </div>
                </div>
            </section>

            <!-- SecciÃ³n de CÃ¡lculos -->
            <section class="control-section">
                <h2><i class="fas fa-calculator"></i> Calcular</h2>
                <div class="calculation-card">

                    <!-- Formulario Flask -->
                    <form action="{{ url_for('consumo_bp.manual_control') }}" method="post" class="analisis-form">
                        <div class="form-group">
                            <label for="cantidad_agua">Ingrese cantidad de agua (L):</label>
                            <input type="number" name="cantidad_agua" class="form-control" placeholder="Ej: 120" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="personas">NÃºmero de personas:</label>
                            <input type="number" name="personas" class="form-control" placeholder="Ej: 3" required>
                        </div>

                        <div class="form-group">
                            <label for="dias">DÃ­as del periodo:</label>
                            <input type="number" name="dias" class="form-control" placeholder="Ej: 30" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-calculator"></i> Calcular Consumo
                        </button>
                    </form>

                    <!-- Resultado del anÃ¡lisis -->
                    {% if resultado %}
                    <div class="analisis-card">
                        {% if resultado.estado == "Normal" %}
                        <div class="estado normal">
                            <h3>Consumo Normal</h3>
                        </div>
                        {% elif resultado.estado == "Alto" %}
                        <div class="estado alto">
                            <h3>Consumo Elevado</h3>
                        </div>
                        {% else %}
                        <div class="estado excesivo">
                            <h3>Consumo Excesivo</h3>
                        </div>
                        {% endif %}
                        <p>{{ resultado.mensaje }}</p>
                        <p><strong>Litros por persona/dÃ­a:</strong> {{ '%.0f'|format(resultado.lppd) }}</p>
                        <div class="tips">
                            <h4>ðŸ’¡ Recomendaciones</h4>
                            <ul>
                                {% for tip in resultado.tips %}
                                <li>{{ tip }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    {% endif %}

                    {% if error %}
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> {{ error }}
                    </div>
                    {% endif %}
                </div>
            </section>
        </div>
    </main>

    <!-- tu HTML arriba -->
<script>
document.getElementById("waterForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const litros = parseFloat(document.getElementById("litros").value);
  const personas = parseInt(document.getElementById("personas").value);
  const resultado = document.getElementById("resultado");
  const nivel = document.getElementById("nivel");
  const detalle = document.getElementById("detalle");
  const litrosPorPersona = document.getElementById("litrosPorPersona");
  const recomendaciones = document.getElementById("recomendaciones");

  if (isNaN(litros) || isNaN(personas) || personas <= 0) {
    alert("Por favor, ingresa valores vÃ¡lidos.");
    return;
  }

  const consumo = litros / personas; // cÃ¡lculo principal
  litrosPorPersona.textContent = consumo.toFixed(2);

  resultado.style.display = "block";
  recomendaciones.innerHTML = "";
  resultado.className = "analisis-card";

  if (consumo <= 1) {
    nivel.textContent = "Consumo Normal";
    detalle.textContent = "Consumo saludable: 1 L por persona/dÃ­a.";
    resultado.classList.add("estado", "normal");
    recomendaciones.innerHTML = `
      <h4>ðŸ’¡ Recomendaciones</h4>
      <ul>
        <li>MantÃ©n los buenos hÃ¡bitos de ahorro.</li>
        <li>Reutiliza agua (lavadora, enjuagues) para limpieza de pisos/patios.</li>
      </ul>`;
  } else if (consumo <= 3) {
    nivel.textContent = "Consumo Alto";
    detalle.textContent = "EstÃ¡s usando mÃ¡s agua de la recomendada. Reduce tu consumo.";
    resultado.classList.add("estado", "alto");
    recomendaciones.innerHTML = `
      <h4>ðŸ’§ Recomendaciones</h4>
      <ul>
        <li>Verifica fugas o grifos mal cerrados.</li>
        <li>Reduce el tiempo de ducha a menos de 5 minutos.</li>
      </ul>`;
  } else {
    nivel.textContent = "Consumo Excesivo";
    detalle.textContent = "El consumo es muy alto. Toma medidas urgentes.";
    resultado.classList.add("estado", "excesivo");
    recomendaciones.innerHTML = `
      <h4>ðŸš¨ Recomendaciones</h4>
      <ul>
        <li>Evita lavar vehÃ­culos con manguera.</li>
        <li>Implementa recolectores de agua lluvia.</li>
        <li>Revisa fugas en cisternas o tuberÃ­as.</li>
      </ul>`;
  }
});
</script>
</body>
</html>

