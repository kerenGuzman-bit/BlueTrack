<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora de Huella Hídrica - BlueTrack</title>

<!-- Fuentes y librerías -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{
    --brand:#0a7bd4;
    --muted:#6b7280;
    --bg:#f6fbff;
  }
  body{font-family:'Poppins',sans-serif;margin:0;background:var(--bg);color:#123;}
  .container{max-width:1100px;margin:28px auto;padding:20px;}
  .hero{background:linear-gradient(135deg,#0a5aa1,#0a7bd4);color:white;border-radius:14px;padding:28px 32px;margin-bottom:20px;box-shadow:0 8px 30px rgba(10,123,212,0.12);}
  .hero h1{margin:0;font-size:28px;}
  .layout{display:grid;grid-template-columns:1fr 380px;gap:20px;margin-top:18px;}
  @media(max-width:980px){.layout{grid-template-columns:1fr;}.aside{order:2}}
  .card{background:white;padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06);}
  .step{display:none}.step.active{display:block}
  .progress-wrap{height:10px;background:#e6eef8;border-radius:999px;overflow:hidden;margin-bottom:12px}
  .progress-bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),#00b4ff)}
  .question{margin:12px 0}
  label{display:block;margin-bottom:6px;font-weight:600}
  input[type="number"], select{width:100%;padding:10px;border-radius:10px;border:1px solid #dde6f2;outline:none;font-size:15px;background:#fbfdff;}
  .btns{display:flex;gap:10px;margin-top:14px;align-items:center}
  .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
  .btn.primary{background:var(--brand);color:white}
  .btn.ghost{background:transparent;border:1px solid #d6e6fb;color:var(--brand)}
  .small{font-size:13px;color:var(--muted)}
  .aside .card{position:sticky;top:24px}
  .result-summary{display:flex;flex-direction:column;gap:10px}
  .result-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:#fbfdff;border:1px solid #eef6ff}
  .chart-wrap{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  canvas{background:white;border-radius:10px;padding:8px}
  .tips{display:flex;flex-direction:column;gap:8px;margin-top:10px}
  .tip{background:#f2fbff;padding:12px;border-left:4px solid var(--brand);border-radius:8px}
  .export-row{display:flex;gap:10px;align-items:center;justify-content:flex-end;margin-top:10px}
</style>
</head>
<body>
<div class="container">
  <div class="hero">
    <h1>Calculadora de Huella Hídrica</h1>
    <p class="small">Estima el volumen de agua directo e indirecto asociado a tus hábitos. Los valores son aproximados.</p>
  </div>

  <div class="layout">
    <!-- MAIN WIZARD -->
    <div>
      <div class="card">
        <div class="progress-wrap"><div id="progress" class="progress-bar"></div></div>

        <!-- STEP 1 -->
        <div id="step-1" class="step active">
          <h3>Paso 1 — Uso doméstico</h3>
          <div class="question">
            <label>1) Minutos promedio de ducha por día</label>
            <input id="q_ducha" type="number" min="0" placeholder="Ej: 10">
            <div class="small">Si usas ducha con caudal estándar ~10-15 L/min</div>
          </div>
          <div class="question">
            <label>2) Veces que lavas ropa a la semana</label>
            <input id="q_lavado" type="number" min="0" placeholder="Ej: 2">
          </div>
          <div class="question">
            <label>3) Uso semanal de lavadora (ciclos)</label>
            <input id="q_lavadora" type="number" min="0" placeholder="Ej: 3">
          </div>
          <div class="question">
            <label>4) Uso semanal de lavaplatos (ciclos)</label>
            <input id="q_lavaplatos" type="number" min="0" placeholder="Ej: 2">
          </div>
          <div class="btns">
            <button class="btn primary" onclick="nextStep()">Siguiente</button>
            <button class="btn ghost" onclick="resetAll()">Reiniciar</button>
          </div>
        </div>

        <!-- STEP 2 -->
        <div id="step-2" class="step">
          <h3>Paso 2 — Hábitos de cocina</h3>
          <div class="question">
            <label>5) Consumo semanal de carne (por persona) en porciones</label>
            <input id="q_carne" type="number" min="0" placeholder="Ej: 3">
          </div>
          <div class="question">
            <label>6) Frutas y verduras (porciones semanales)</label>
            <input id="q_fruta" type="number" min="0" placeholder="Ej: 14">
          </div>
          <div class="btns">
            <button class="btn" onclick="prevStep()">Anterior</button>
            <button class="btn primary" onclick="nextStep()">Siguiente</button>
          </div>
        </div>

        <!-- STEP 3 -->
        <div id="step-3" class="step">
          <h3>Paso 3 — Jardín y otros</h3>
          <div class="question">
            <label>7) Uso de riego (litros/día aproximado)</label>
            <input id="q_riego" type="number" min="0" placeholder="Ej: 0">
          </div>
          <div class="question">
            <label>8) ¿Recoges agua de lluvia?</label>
            <select id="q_lluvia">
              <option value="no">No</option>
              <option value="si">Sí, parcialmente</option>
            </select>
          </div>
          <div class="btns">
            <button class="btn" onclick="prevStep()">Anterior</button>
            <button class="btn primary" onclick="nextStep()">Siguiente</button>
          </div>
        </div>

        <!-- STEP 4 -->
        <div id="step-4" class="step">
          <h3>Paso 4 — Agua indirecta</h3>
          <div class="question">
            <label>9) Gastas en promedio (COP) en comida semanal por persona</label>
            <input id="q_gasto" type="number" min="0" placeholder="Ej: 70000">
          </div>
          <div class="question">
            <label>10) ¿Compras productos locales o importados con frecuencia?</label>
            <select id="q_local">
              <option value="local">Mayoritariamente local</option>
              <option value="mixto">Mixto</option>
              <option value="import">Importados frecuentes</option>
            </select>
          </div>
          <div class="btns">
            <button class="btn" onclick="prevStep()">Anterior</button>
            <button class="btn primary" onclick="nextStep()">Siguiente</button>
          </div>
        </div>

        <!-- STEP 5 -->
        <div id="step-5" class="step">
          <h3>Paso 5 — Transporte & energía</h3>
          <div class="question">
            <label>11) Consumo promedio de agua asociado a la energía (L/día)</label>
            <input id="q_energia" type="number" min="0" placeholder="Ej: 10">
          </div>
          <div class="question">
            <label>12) ¿Deseas incluir cálculos por compra de ropa?</label>
            <select id="q_ropa">
              <option value="no">No</option>
              <option value="si">Sí</option>
            </select>
          </div>
          <div class="question">
            <label>13) Consumo semanal en transporte (km)</label>
            <input id="q_transporte" type="number" min="0" placeholder="Ej: 20">
          </div>
          <div class="btns">
            <button class="btn" onclick="prevStep()">Anterior</button>
            <button class="btn primary" onclick="finishWizard()">Calcular Resultado</button>
          </div>
        </div>

        <!-- RESULTADOS -->
        <div id="final-result" class="step" style="display:none;margin-top:12px">
          <h3>Resultado estimado</h3>
          <div id="summaryText" class="small"></div>
          <div style="margin-top:12px" class="chart-wrap">
            <canvas id="chartDoughnut" width="260" height="260"></canvas>
            <canvas id="chartBar" width="360" height="260"></canvas>
          </div>
          <div class="export-row">
            <div style="flex:1"></div>
            <button class="btn ghost" onclick="resetAll()">Recalcular</button>
            <button class="btn primary" onclick="exportPDF()">Exportar a PDF</button>
          </div>
          <div style="margin-top:14px" class="tips"></div>
        </div>
      </div>
    </div>

    <!-- ASIDE -->
    <aside class="aside">
      <div class="card">
        <h3>Resumen rápido</h3>
        <div class="result-summary">
          <div class="result-item"><div>Huella día (L)</div><div id="res_day">—</div></div>
          <div class="result-item"><div>Huella mes (L)</div><div id="res_month">—</div></div>
          <div class="result-item"><div>Huella anual (m³)</div><div id="res_year">—</div></div>
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
const steps = ['step-1','step-2','step-3','step-4','step-5'];
let current = 0;
let doughnutChart=null, barChart=null;

function showStep(idx){
  steps.forEach((id,i)=>document.getElementById(id).classList.toggle('active', i===idx));
  document.getElementById('progress').style.width = Math.round((idx/steps.length)*100)+'%';
  current=idx;
}
function nextStep(){if(current<steps.length-1) showStep(current+1);}
function prevStep(){if(current>0) showStep(current-1);}

function finishWizard(){
  const ducha=Number(document.getElementById('q_ducha').value)||0;
  const lavado=Number(document.getElementById('q_lavado').value)||0;
  const lavadora=Number(document.getElementById('q_lavadora').value)||0;
  const lavaplatos=Number(document.getElementById('q_lavaplatos').value)||0;
  const carne=Number(document.getElementById('q_carne').value)||0;
  const fruta=Number(document.getElementById('q_fruta').value)||0;
  const riego=Number(document.getElementById('q_riego').value)||0;
  const lluvia=document.getElementById('q_lluvia').value||'no';
  const gasto=Number(document.getElementById('q_gasto').value)||0;
  const local=document.getElementById('q_local').value||'local';
  const energia=Number(document.getElementById('q_energia').value)||0;
  const ropaIncl=document.getElementById('q_ropa').value||'no';
  const transporte=Number(document.getElementById('q_transporte').value)||0;

  // parámetros
  const L_PER_MIN=10;
  const L_PER_LAVADO=50;
  const L_PER_LAVADORA=50;
  const L_PER_LAVAPLATOS=15;
  const VIRTUAL_PER_COP=0.002;
  const carne_porcion=4300;
  const fruta_porcion=50;

  // cálculos
  const ducha_daily=ducha*L_PER_MIN;
  const lavado_daily=lavado*L_PER_LAVADO/7;
  const lavadora_daily=lavadora*L_PER_LAVADORA/7;
  const lavaplatos_daily=lavaplatos*L_PER_LAVAPLATOS/7;
  const riego_daily=riego;
  const carne_week=carne*carne_porcion;
  const fruta_week=fruta*fruta_porcion;
  const virtual_food_daily=(carne_week+fruta_week)/7;
  const virtual_money_daily=gasto*VIRTUAL_PER_COP;
  const ropa_extra=(ropaIncl==='si')?20:0;
  const import_factor=(local==='import')?1.25:(local==='mixto')?1.1:1;
  const transporte_factor=transporte*0.5;

  const total_day=(ducha_daily+lavado_daily+lavadora_daily+lavaplatos_daily+riego_daily+virtual_food_daily+virtual_money_daily+energia+ropa_extra+transporte_factor)*import_factor;

  document.getElementById('res_day').innerText=total_day.toFixed(1)+' L';
  document.getElementById('res_month').innerText=(total_day*30).toFixed(0)+' L';
  document.getElementById('res_year').innerText=(total_day*365/1000).toFixed(1)+' m³';

  document.getElementById('summaryText').innerText=`Tu huella hídrica diaria aproximada es de ${total_day.toFixed(1)} litros considerando agua directa e indirecta.`;

  // tips dinámicos presentes y futuros
  const tipsDynamic=[];
  if(ducha_daily>100) tipsDynamic.push("Reducir 2 minutos de ducha puede ahorrar más de 20 L/día.");
  if(carne>3) tipsDynamic.push("Disminuir consumo de carne reduce significativamente tu huella hídrica.");
  if(riego>50) tipsDynamic.push("Considera regar temprano en la mañana para evitar evaporación.");
  if(transporte>50) tipsDynamic.push("Reducir uso de vehículo puede ahorrar litros de agua virtual asociada al combustible.");

  document.querySelector(".tips").innerHTML=tipsDynamic.map(t=>`<div class="tip"><b>Consejo:</b> ${t}</div>`).join('');

  // charts
  const dataDoughnut=[ducha_daily+lavado_daily+lavadora_daily+lavaplatos_daily,virtual_food_daily+virtual_money_daily,riego_daily+energia,ropa_extra+transporte_factor];
  const labelsDoughnut=['Doméstico','Alimentos & gastos','Riego & energía','Ropa & transporte'];

  if(doughnutChart) doughnutChart.destroy();
  doughnutChart=new Chart(document.getElementById('chartDoughnut').getContext('2d'),{
    type:'doughnut',
    data:{labels:labelsDoughnut,datasets:[{data:dataDoughnut,backgroundColor:['#0a7bd4','#00b4ff','#0a95d1','#00d4ff']}]},
    options:{responsive:true,plugins:{legend:{position:'bottom'}}}
  });

  if(barChart) barChart.destroy();
  barChart=new Chart(document.getElementById('chartBar').getContext('2d'),{
    type:'bar',
    data:{labels:labelsDoughnut,datasets:[{label:'Litros diarios',data:dataDoughnut,backgroundColor:['#0a7bd4','#00b4ff','#0a95d1','#00d4ff']}]},
    options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
  });

  showStep(steps.length);
}

function resetAll(){location.reload();}

function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("Huella Hídrica Personal", 14, 20);
  doc.text(document.getElementById('summaryText').innerText,14,30);
  doc.save("huella_hidrica.pdf");
}
</script>
</body>
</html>
